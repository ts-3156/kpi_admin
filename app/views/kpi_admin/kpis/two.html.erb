<%= render partial: 'selector' %>

<div><%= link_to('KPIs', root_path, class: 'btn btn-default') %></div>

<div class="row">
  <div class="col-xs-12 col-sm-6">
    <%= image_tag asset_path('kpi_admin/ajax-loader.gif'), class: 'loading' %>
    <div class="kpis search_num"></div>
  </div>
  <div class="col-xs-12 col-sm-6">
    <%= image_tag asset_path('kpi_admin/ajax-loader.gif'), class: 'loading' %>
    <div class="kpis search_num_verification"></div>
  </div>

  <div class="col-xs-12 col-sm-6">
    <%= image_tag asset_path('kpi_admin/ajax-loader.gif'), class: 'loading' %>
    <div class="kpis search_num_per_action"></div>
  </div>
  <div class="col-xs-12 col-sm-6">
    <%= image_tag asset_path('kpi_admin/ajax-loader.gif'), class: 'loading' %>
    <div class="kpis search_rate_per_action"></div>
  </div>

  <div class="col-xs-12 col-sm-6">
    <%= image_tag asset_path('kpi_admin/ajax-loader.gif'), class: 'loading' %>
    <div class="kpis search_num_per_channel"></div>
  </div>
  <div class="col-xs-12 col-sm-6">
    <%= image_tag asset_path('kpi_admin/ajax-loader.gif'), class: 'loading' %>
    <div class="kpis search_rate_per_channel"></div>
  </div>

  <div class="col-xs-12 col-sm-6">
    <%= image_tag asset_path('kpi_admin/ajax-loader.gif'), class: 'loading' %>
    <div class="kpis search_num_by_google"></div>
  </div>
  <div class="col-xs-12 col-sm-6">
    <%= image_tag asset_path('kpi_admin/ajax-loader.gif'), class: 'loading' %>
    <div class="kpis xxx"></div>
  </div>
</div>

<div><%= link_to('KPIs', root_path, class: 'btn btn-default') %></div>

<script>
  function reload() {
    $('.loading').show();
    $('.kpis').empty();
    charts = {};

    var url = "<%= two_path %>";
    var types = [
      'search_num',
      'search_num_verification',
      'search_num_per_action',
      'search_rate_per_action',
      'search_num_per_channel',
      'search_num_by_google'
    ];
    fetch(url, types[0], true)
        .then(function(){return fetch(url, types[1], true)})
        .then(function(){return fetch(url, types[2], true)})
        .then(function(){return fetch(url, types[3], true)})
        .then(function(){return fetch(url, types[4], true)})
        .then(function(){return fetch(url, types[5], true)});
  }

  $('input[name=time_zone]:radio').on('change', reload);
  $('input[name=frequency]:radio').on('change', reload);
  $('input[name=duration]:radio').on('change', reload);
  $('input[name=user_id]:radio').on('change', reload);
  $('input[name=ego_surfing]:radio').on('change', reload);
  $('input[name=_action]:radio').on('change', reload);
  $('input[name=device_type]:radio').on('change', reload);
  $('input[name=channel]:radio').on('change', reload);

  $(function () {
    reload();
  });
</script>
